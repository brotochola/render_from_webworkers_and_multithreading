<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>PixiJS 8 in Web Worker</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #111;
        }

        canvas {
            display: block;
            width: 800px;
            height: 600px;
            border: 1px solid #333;
        }

        p {
            color: white;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);

        }
    </style>
</head>
<body>
    <p id="pixiWorkerFPS"></p>
    <p id="logicWorkerFPS"></p>



    <script>
        // Crear elemento canvas e insertarlo en el DOM
        const width = 800, height = 600;
        const resolution = window.devicePixelRatio;
        const canvas = document.createElement('canvas');
        canvas.style.width = `${width}px`;
        canvas.style.height = `${height}px`;
        document.body.appendChild(canvas);
        console.log("generated canvas", canvas);

        // Crear los workers
        const pixiWorker = new Worker('pixi_worker.js');
        const logicWorker = new Worker('logic_worker.js');

        // Crear un MessageChannel para comunicación directa entre workers
        const channel = new MessageChannel();

        // Transferir el canvas al pixi worker
        const view = canvas.transferControlToOffscreen();
        pixiWorker.postMessage({ msg: "init", width, height, resolution, view }, [view]);

        // Enviar un puerto del canal a cada worker para que se comuniquen directamente
        pixiWorker.postMessage({ msg: "setPort", port: channel.port1 }, [channel.port1]);
        logicWorker.postMessage({ msg: "setPort", port: channel.port2 }, [channel.port2]);

        // Escuchar mensajes del pixi worker (solo para debugging/UI)
        pixiWorker.onmessage = (e) => {
            // console.log("MAIN recibió datos del pixi worker", e.data);
            if (e.data.msg === "fps") {
                document.querySelector('#pixiWorkerFPS').textContent = "pixi worker fps: " + e.data.fps;
            }
        }

        // Escuchar mensajes del logic worker (solo para debugging/UI)
        logicWorker.onmessage = (e) => {
            // console.log("MAIN recibió datos del logic worker", e.data);
            if (e.data.msg === "fps") {
                document.querySelector('#logicWorkerFPS').textContent = "logic worker fps: " + e.data.fps;
            }
        }
    </script>
</body>
</html>